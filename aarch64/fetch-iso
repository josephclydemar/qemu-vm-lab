#!/usr/bin/env bash

set -euo pipefail

usage() {
cat <<EOF >&2
Usage: ./${0##*/} <iso-url>
Try './${0##*/} --help' for more details.
EOF
  exit "${1:-2}"
}

help() {
cat <<'EOF'
NAME
  fetch-iso - Download an ISO into the local isos directory

SYNOPSIS
  fetch-iso <iso-url>

DESCRIPTION
  Downloads the ISO from the given URL using wget and saves it into the
  isos directory (relative to the repository root), preserving the original
  filename. Intended for fetching ARM64-friendly installer media that will be
  used with the install and run scripts in this repo.

OPTIONS
  -h, --help            Show this help and exit

ARGUMENTS
  <iso-url>             Direct URL to the .iso file to download

EXAMPLES
  ./fetch-iso https://cdimage.debian.org/debian-cd/current/arm64/iso-cd/debian-12.6.0-arm64-netinst.iso
  ./fetch-iso https://releases.ubuntu.com/24.04/ubuntu-24.04-live-server-arm64.iso

EXIT STATUS
  0  Success
  2  Usage error (invalid args)
EOF
  exit 0
}

ISO_URL=""
while [ $# -gt 0 ]; do
  case "$1" in
    -h|--help) help ;;
    --) shift; break ;;
    -*) echo "./${0##*/}: unknown option: $1" >&2; usage ;;
    *) ISO_URL="$1"; shift; break ;;
  esac
done

[ -n "$ISO_URL" ] || usage
[ $# -eq 0 ] || usage

mkdir -p isos
set -x
wget -P isos -- "$ISO_URL"

